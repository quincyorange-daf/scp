
#***** deny access to create public facing S3 buckets *******
data "aws_iam_policy_document" "deny_s3_logs" {
  statement {
    sid       = "deny_s3_logs"
    effect    = "Deny"
    actions   = [
                 "s3:DeleteBucket",
                 "s3:DeleteObject",
                 "s3:DeleteObjectVersion"
                 ]
    resources = [
                 "arn:aws:s3:::bcp-itp-production-accounts-cloudtrail",
                 "arn:aws:s3:::bcp-itp-production-accounts-cloudtrail-temp",
                 "arn:aws:s3:::bcp-itp-production-accounts-config",
                 "arn:aws:s3:::bcp-itp-production-accounts-guardduty",
                 "arn:aws:s3:::bcp-itp-production-accounts-serverproxy",
                 "arn:aws:s3:::bcp-itp-production-accounts-vpcflowlogs",
                 "arn:aws:s3:::bcp-itp-production-accounts-waf",
                 "arn:aws:s3:::bcp-itp-queryresults",
                 "arn:aws:s3:::itp-centralised-cloudtrail-global",
                 "arn:aws:s3:::itp-centralised-cloudtrail-splunk",
                 "arn:aws:s3:::itp-centralised-logs",
                 "arn:aws:s3:::itp-daf-accounts-accesslogs",
                 "arn:aws:s3:::itp-daf-accounts-config",
                 "arn:aws:s3:::itp-daf-accounts-flowlogs",
                 "arn:aws:s3:::itp-daf-accounts-trails"
                 ]
  }
}


#### create the policy and attach the policy rules ########
resource "aws_organizations_policy" "deny_s3_logs" {
  name        = "deny_s3_logs"
  description = "Allow certain EC2 instance types only."
  content     = data.aws_iam_policy_document.deny_s3_logs.json
}

 #### To attch policy on Organization Account ########
 resource "aws_organizations_policy_attachment" "deny_s3_logs" {
   policy_id = aws_organizations_policy.deny_s3_logs.id  ## (Required) The unique identifier (ID) of the policy that you want to attach to the target.
  target_id = "ou-g5q"  ## (Required) The unique identifier (ID) organizational unit, you want to attach the policy to.
 }